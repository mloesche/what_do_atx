# Deployment Guide: Vercel + Render

This guide walks you through deploying the What Do ATX application using Vercel for the frontend and Render for the backend services.

## üèóÔ∏è Architecture Overview

- **Frontend**: Next.js application deployed on Vercel
- **Backend**: Node.js API services deployed on Render  
- **Database**: Managed PostgreSQL on Render with PostGIS + pgvector extensions
- **CI/CD**: GitHub Actions for automated testing and deployment

## üìã Prerequisites

- GitHub repository with the application code
- Vercel account (free tier available)
- Render account (free tier available)  
- Domain name (optional, for custom domains)

---

## üöÄ Frontend Deployment (Vercel)

### Step 1: Connect Repository to Vercel

1. **Sign in to Vercel**: Go to [vercel.com](https://vercel.com) and sign in with GitHub
2. **Import Project**: Click "New Project" and import your GitHub repository
3. **Configure Build Settings**:
   - Framework Preset: `Next.js`
   - Build Command: `npm run build` (auto-detected)
   - Output Directory: `.next` (auto-detected)
   - Install Command: `npm ci` (auto-detected)

### Step 2: Configure Environment Variables

In your Vercel project dashboard:

1. Go to **Settings ‚Üí Environment Variables**
2. Add the following variables for **Production**, **Preview**, and **Development**:

```bash
# Frontend API Configuration
NEXT_PUBLIC_API_URL=https://your-backend-service.onrender.com
NEXT_PUBLIC_FRONTEND_URL=https://your-frontend.vercel.app

# Authentication (will be set up later)
NEXTAUTH_URL=https://your-frontend.vercel.app
NEXTAUTH_SECRET=your-nextauth-secret
GOOGLE_CLIENT_ID=your-google-client-id
GOOGLE_CLIENT_SECRET=your-google-client-secret

# Feature Flags
NEXT_PUBLIC_ENABLE_CHAT=true
NEXT_PUBLIC_ENABLE_RECOMMENDATIONS=true
```

### Step 3: Deploy and Test

1. **Initial Deployment**: Vercel will automatically build and deploy on first import
2. **Custom Domain** (Optional): 
   - Go to **Settings ‚Üí Domains**
   - Add your custom domain and configure DNS
3. **Test Deployment**: Visit your Vercel URL to verify the frontend is working

---

## üñ•Ô∏è Backend Deployment (Render)

### Step 1: Create Render Account and Services

1. **Sign up at Render**: Go to [render.com](https://render.com) and create an account
2. **Connect GitHub**: Link your GitHub account in Render dashboard

### Step 2: Create Database Service

1. **Create PostgreSQL Database**:
   - Click "New +" ‚Üí "PostgreSQL"
   - Name: `what-do-atx-db`
   - Database: `what_do_atx`
   - User: `what_do_atx_user`
   - Region: Choose closest to your users
   - Plan: Start with Free tier

2. **Enable Extensions** (after database is created):
   - Go to database shell or connect via psql
   - Run these commands:
   ```sql
   CREATE EXTENSION IF NOT EXISTS postgis;
   CREATE EXTENSION IF NOT EXISTS vector;
   ```

### Step 3: Create Web Service

1. **Create New Web Service**:
   - Click "New +" ‚Üí "Web Service"
   - Connect your GitHub repository
   - Name: `what-do-atx-api`
   - Root Directory: `backend`
   - Environment: `Node`
   - Build Command: `npm ci`
   - Start Command: `npm start`

2. **Configure Environment Variables**:
   ```bash
   # Application
   NODE_ENV=production
   PORT=10000
   LOG_LEVEL=info
   
   # Database (auto-generated by Render)
   DATABASE_URL=[Auto-filled from database service]
   
   # Security
   JWT_SECRET=[Generate a secure secret]
   CORS_ORIGIN=https://your-frontend.vercel.app
   
   # External APIs (set these up in respective services)
   OPENAI_API_KEY=sk-your-openai-key
   GOOGLE_OAUTH_CLIENT_ID=your-google-client-id
   GOOGLE_OAUTH_CLIENT_SECRET=your-google-client-secret
   EVENTBRITE_API_KEY=your-eventbrite-key
   ```

### Step 4: Configure Auto-Deploy

1. **Branch Configuration**: Set main branch for production deploys
2. **Health Check**: Render will automatically monitor `/health` endpoint
3. **Deploy**: Click "Deploy" to start initial deployment

---

## ‚öôÔ∏è CI/CD Setup (GitHub Actions)

### Step 1: Repository Secrets

Add these secrets in your GitHub repository (**Settings ‚Üí Secrets and variables ‚Üí Actions**):

```bash
# Vercel Configuration
VERCEL_TOKEN=your-vercel-token
VERCEL_ORG_ID=your-org-id
VERCEL_PROJECT_ID=your-project-id

# Render Configuration  
RENDER_API_KEY=your-render-api-key
RENDER_SERVICE_ID=your-backend-service-id
```

### Step 2: Get Required Tokens

**Vercel Tokens**:
1. Go to [Vercel Account Settings](https://vercel.com/account/tokens)
2. Create a new token with appropriate scope
3. Get Project and Org IDs from project settings

**Render API Key**:
1. Go to [Render Account Settings](https://dashboard.render.com/account/api-keys)
2. Create a new API key
3. Get Service ID from your web service URL

### Step 3: Test CI/CD Pipeline

1. **Push to Main**: Push code to main branch to trigger deployment
2. **Check Actions**: Monitor GitHub Actions tab for deployment status
3. **Verify Deployment**: Check both Vercel and Render deployments

---

## üîß Cross-Service Configuration

### Update Frontend Environment Variables

Once backend is deployed, update these in Vercel:

```bash
NEXT_PUBLIC_API_URL=https://your-actual-backend.onrender.com
```

### Update Backend CORS Settings

Update backend environment variable in Render:

```bash
CORS_ORIGIN=https://your-actual-frontend.vercel.app
ALLOWED_ORIGINS=https://your-actual-frontend.vercel.app,https://your-staging.vercel.app
```

---

## üß™ Testing Deployment

### Automated Tests

The CI/CD pipeline includes:
- ‚úÖ Frontend build and type checking
- ‚úÖ Backend API testing with test database
- ‚úÖ Cross-service communication testing
- ‚úÖ Health check verification

### Manual Testing

1. **Frontend Health**: Visit your Vercel URL
2. **Backend Health**: Visit `https://your-backend.onrender.com/health`
3. **CORS Testing**: Open browser dev tools and test API calls from frontend

---

## üö® Troubleshooting

### Common Issues

**Frontend Build Failures**:
- Check environment variables are set correctly
- Verify Node.js version compatibility
- Review build logs in Vercel dashboard

**Backend Deployment Issues**:
- Verify `package.json` scripts are correct
- Check environment variables in Render
- Review service logs in Render dashboard

**Database Connection Issues**:
- Ensure DATABASE_URL is correctly set
- Verify database service is running
- Check connection limits and credentials

**CORS Errors**:
- Verify CORS_ORIGIN matches exactly (including https://)
- Add Vercel preview domains to allowed origins
- Check browser developer tools for specific CORS errors

### Performance Optimization

**Frontend (Vercel)**:
- Enable Analytics in Vercel dashboard
- Configure caching headers in `vercel.json`
- Use Vercel Image Optimization for images

**Backend (Render)**:
- Monitor response times in Render dashboard
- Implement database connection pooling
- Add Redis for caching (separate Render service)

---

## üìä Monitoring and Maintenance

### Health Monitoring

- **Uptime**: Both Render and Vercel provide uptime monitoring
- **Logs**: Check service logs regularly for errors
- **Performance**: Monitor response times and resource usage

### Regular Maintenance

- **Dependencies**: Keep packages updated
- **Security**: Rotate API keys and secrets regularly
- **Database**: Monitor storage usage and performance
- **Backups**: Render provides automatic database backups

---

## üîê Security Checklist

- [ ] All environment variables are set securely
- [ ] JWT secrets are properly generated and stored
- [ ] CORS is configured correctly
- [ ] HTTPS is enforced on all endpoints
- [ ] Rate limiting is enabled
- [ ] Input validation is implemented
- [ ] Database access is restricted
- [ ] API keys are rotated regularly

---

## üìû Support Resources

- **Vercel Documentation**: [vercel.com/docs](https://vercel.com/docs)
- **Render Documentation**: [render.com/docs](https://render.com/docs)
- **Next.js Documentation**: [nextjs.org/docs](https://nextjs.org/docs)
- **PostgreSQL Documentation**: [postgresql.org/docs](https://postgresql.org/docs)

For project-specific issues, check the repository's issue tracker or contact the development team. 